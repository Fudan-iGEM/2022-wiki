<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1 ,maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" href="https://static.igem.wiki/teams/4162/wiki/index/logo-round.png">
    <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

    <!-- Bootstrap CSS -->
    <link href="{{ url_for('static', filename = 'bootstrap.min.css') }}" rel="stylesheet">

    <!-- Custom CSS -->
    <!-- link href="{{ url_for('static', filename = 'style.css') }}" rel="stylesheet" -->
    <link rel="stylesheet" href="{{ url_for('static', filename = 'wheel-menu.css') }}?v={{ __build__ }}">
    <link rel="stylesheet" href="{{ url_for('static', filename = 'loading.css') }}?v={{ __build__ }}">
    <link rel="stylesheet" href="{{ url_for('static', filename = 'landingpage.css') }}?v={{ __build__ }}">
    <link rel="stylesheet" href="{{ url_for('static', filename = 'index.css') }}?v={{ __build__ }}">

    <title>{% block title %}{% endblock %} | Fudan - iGEM 2022</title>
    <meta name="author" content="{% block author_name %}{% endblock %}" />
</head>
<body>
  <!-- Navigation -->
  {% include 'menu.html' %}

  <!-- Header -->

  <!-- Page Content, with side bar -->
  {% block side_bar %}{% endblock %}
  <div class="container">
    <article>{% block page_content %}{% endblock %}</article>
  </div>

  <!-- Footer: MUST mention license AND have a link to team wiki's repository on gitlab.igem.org -->
  {% include 'footer.html' %}

  <!-- Wiki Tools: Teams are allowed to remove it -->
  {% include 'wiki-tools.html' %}

  <!-- Bootstrap Bundle with Popper -->
  <script src="{{ url_for('static', filename = 'jquery-2.1.1.min.js') }}"></script>  
  <script src="{{ url_for('static', filename = 'bootstrap.bundle.min.js') }}"></script>
  <!-- TweenMax.min.js TimelineMax.min.js ScrollMagic.min.js animation.gsap.min.js -->
  <!-- ionicons.esm.js ionicons.js -->
  <!-- wheelmenu.js loading.js landingpage.js -->
  <script>
  window.addEventListener('load', () => {
    setTimeout(function () {
      const loader = document.querySelector('.loader');
      if (loader !== null) {
        loader.classList.add('loader--hidden');
        loader.addEventListener('transitionend', () => {
          try {
            document.body.removeChild(loader);
          } catch (err) {
            console.log('loading.js', err);
          }
        });
      }
    }, 1000);
  });

  $(document).ready(function () {
    // footer, div > a
    $(document).delegate('div.logos', 'click', function () {
      window.location = $(this).find('a').attr('href');
    });

    $('#page_author').text( $('meta[name=author]').attr('content') );

    // sidebar arrow
    const arrow = document.querySelectorAll(".arrow");
    for (var i = 0; i < arrow.length; i++) {
      arrow[i].addEventListener("click", (e)=>{
        //console.log(arrow)
        const arrowParent = e.target.parentElement.parentElement; // selecting main parent of arrow
        arrowParent.classList.toggle("showmenu");
      });
    }

    $(window).on('resize', function () {
      const win = $(this);
      if (win.width() < 768) { // #landingpage  display: none;
        $('#landingpage').hide();
      } else {
        $('#landingpage').show();
      }
      if (win.width() < 992) { // footer menu
        $('#hideWhen992').hide();
      } else {
        $('#hideWhen992').show();
      }
    });

    $(window).on('scroll', function () {
      const link = $('.dot-landingpage');
      const top = $(window).scrollTop();
      $('.section').each(function () {
        const id = $(this).attr('id');
        //console.log(id)
        const height = $(this).height();
        const offset = $(this).offset().top - 150;
        if (top >= offset && top < offset + height) {
          link.removeClass('active');
          $('#landingpage').find('[data-scroll="' + id + '"]').addClass('active');
        }
      });
    });

    // wheelmenu.js
    let toggle = document.querySelector('.toggle')
    let menu = document.querySelector('.menu')
    let menuitem = document.querySelector('.menuitem')
    let menuitem_second = document.querySelector('.menuitem_second')
    let oldpositionx ;
    let oldpositiony ;
    let offsetX = 0, offsetY = 0;

    const move = (e) => {
        if (!menu.classList.contains("active")&&!menuitem.classList.contains("active")) {
            if (e.type === "touchmove") {
                menu.style.top = e.touches[0].clientY - offsetY + "px";
                menu.style.left = e.touches[0].clientX - offsetX + "px";
                e.preventDefault()
            } else {
                menu.style.top = e.clientY - offsetY + "px";
                menu.style.left = e.clientX - offsetX + "px";
                e.preventDefault()
            }
        }
    };

    const mouseDown = (e) => {
        if (e.type === "mousedown") {
            offsetY = e.clientY - menu.getBoundingClientRect().top;
            offsetX = e.clientX - menu.getBoundingClientRect().left;
            window.addEventListener("mousemove", move);
            oldpositionx = menu.style.left;
            oldpositiony = menu.style.top;
            e.preventDefault()
        } else {
            offsetY = e.touches[0].clientY - menu.getBoundingClientRect().top;
            offsetX = e.touches[0].clientX - menu.getBoundingClientRect().left;
            window.addEventListener("touchmove", move);
            oldpositionx = menu.style.left;
            oldpositiony = menu.style.top;
            e.preventDefault()
        }
        menu.style.transition = "none";
    };

    const mouseUp = (e) => {
        if (e.type === "mouseup") {
            window.removeEventListener("mousemove", move);
            offsetX = 0, offsetY = 0;
            e.preventDefault()
        } else {
            window.removeEventListener("touchmove", move);
            offsetX = 0, offsetY = 0;
            e.preventDefault()

        }
        snapToSide(e)
        menu.style.transition = "0.3s ease-in-out left";
    };

    const snapToSide = (e) => {
        const windowWidth = window.innerWidth;
        let currPositionX, currPositionY;
        if (e.type === "touchend") {
            currPositionX = e.changedTouches[0].clientX;
            currPositionY = e.changedTouches[0].clientY;
        } else {
            currPositionX = e.clientX;
            currPositionY = e.clientY;
        }
        if (currPositionX < windowWidth / 2) {
            menu.style.left = 0 + "px";
            menuitem.classList.remove('right');
            menuitem.classList.add('left');
            menuitem_second.classList.remove('right');
            menuitem_second.classList.add('left');
            menu.classList.remove('right');
            menu.classList.add('left');
        } else {
            menu.style.left = windowWidth - 200 + "px";
            menuitem.classList.remove('left');
            menuitem.classList.add('right');
            menuitem_second.classList.remove('left');
            menuitem_second.classList.add('right');
            menu.classList.remove('left');
            menu.classList.add('right');
        }
    };

    if (menu !== null) {
      menu.addEventListener("mousedown", mouseDown);
      menu.addEventListener("mouseup", mouseUp);
      menu.addEventListener("touchstart", mouseDown);
      menu.addEventListener("touchend", mouseUp);
    }

    if (toggle !== null) {
      toggle.addEventListener("click", (e) =>{
        if (oldpositionx === menu.style.left&&
            oldpositiony === menu.style.top){
            if (menuitem.classList.contains('active')) {
                menuitem.classList.toggle('active');
                menu.classList.toggle('active')
                menuitem_second.classList.toggle('active');

            } else {
                menu.classList.toggle('active');
            }
        }
      })
      toggle.addEventListener("touchend", (e) =>{
        if (oldpositionx === menu.style.left&&
            oldpositiony === menu.style.top){
            if (menuitem.classList.contains('active')) {
                menuitem.classList.toggle('active');
                menuitem_second.classList.toggle('active');
                menu.classList.toggle('active')

            } else {
                menu.classList.toggle('active');
            }
        }
      })
    }

  });
  </script>
</body>
</html>
